cmake_minimum_required(VERSION 3.2)

project(qmdnsengine)

set(WORK_DIR "@QMDNS_WORK_DIR@")
set(SOURCE_DIR "@QMDNS_SOURCE_DIR@")
set(INSTALL_DIR "@QMDNS_INSTALL_DIR@")
set(CMAKE_ARGS "@QMDNS_CMAKE_ARGS@")

include(ExternalProject)

ExternalProject_Add(qmdnsengine
    PREFIX                ${WORK_DIR}
    BUILD_ALWAYS          OFF
    DOWNLOAD_COMMAND      ""
    SOURCE_DIR            ${SOURCE_DIR}
    INSTALL_DIR           ${INSTALL_DIR}
    CMAKE_ARGS            ${CMAKE_ARGS}
)

if(WIN32)
    ExternalProject_Add_Step(
        qmdnsengine CopyToBin
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${INSTALL_DIR}/lib/qmdnsengine${CMAKE_SHARED_LIBRARY_SUFFIX} ${INSTALL_DIR}/bin/${CMAKE_CFG_INTDIR}/qmdnsengine${CMAKE_SHARED_LIBRARY_SUFFIX}
        DEPENDEES install
    )
endif()
